# 每日打卡功能说明

## 功能概述

每日打卡功能允许学生每天进行签到打卡，系统会自动记录打卡情况，并在个人界面和管理员界面提供统计和可视化展示。

## 功能特性

### 1. 用户端功能

- **自动打卡提醒**：用户每天第一次登录时，如果未打卡，系统会自动弹出打卡提醒窗口
- **打卡日程表**：在个人中心（学生仪表板）显示最近30天的打卡记录
  - 绿色：已打卡
  - 红色：未打卡
- **今日状态显示**：在日程表下方显示今日打卡状态

### 2. 管理员端功能

- **打卡统计饼状图**：在管理员控制台显示每日打卡统计
  - 显示已打卡和未打卡人数
  - 显示打卡率
- **日期选择器**：可以选择查看任意日期的打卡统计
- **实时数据更新**：选择日期后，图表和数据自动更新

## 数据库结构

### attendance_records 表

- `id`: 主键
- `user_id`: 用户ID（外键关联users表）
- `date`: 打卡日期
- `status`: 打卡状态（checked_in: 已打卡, not_checked: 未打卡）
- `check_in_time`: 打卡时间
- 唯一约束：每个用户每天只能有一条记录（user_id + date）

## API 接口

### 1. 打卡接口
- **路径**: `/attendance/check_in`
- **方法**: POST
- **说明**: 用户进行打卡操作

### 2. 检查今日打卡状态
- **路径**: `/attendance/check_today`
- **方法**: GET
- **说明**: 检查今天是否已打卡

### 3. 获取打卡记录
- **路径**: `/attendance/records`
- **方法**: GET
- **说明**: 获取用户最近30天的打卡记录（用于日程表）

### 4. 获取打卡统计（管理员）
- **路径**: `/attendance/statistics`
- **方法**: GET
- **参数**: `date` (可选，格式: YYYY-MM-DD，默认为今天)
- **说明**: 获取指定日期的打卡统计数据

## 安装和配置

### 1. 运行数据库迁移

首次使用前，需要运行数据库迁移脚本：

```bash
python scripts/migrate_attendance.py
```

或者，如果使用 Flask-Migrate：

```bash
flask db migrate -m "Add attendance records table"
flask db upgrade
```

### 2. 验证功能

1. 以学生身份登录系统
2. 如果今天未打卡，应该会看到打卡弹窗
3. 点击"立即签到"完成打卡
4. 在个人中心查看打卡日程表
5. 以管理员身份登录，查看打卡统计饼状图

## 使用说明

### 学生使用

1. **打卡**：
   - 每天第一次登录时，系统会自动弹出打卡提醒
   - 点击"立即签到"按钮完成打卡
   - 也可以点击"稍后提醒"关闭弹窗，稍后再打卡

2. **查看打卡记录**：
   - 登录后进入个人中心（学生仪表板）
   - 在"打卡日程表"部分查看最近30天的打卡情况
   - 绿色表示已打卡，红色表示未打卡

### 管理员使用

1. **查看打卡统计**：
   - 登录管理员控制台
   - 在"每日打卡统计"部分查看饼状图
   - 使用日期选择器选择要查看的日期
   - 图表会自动更新显示该日期的统计数据

## 技术实现

- **前端**：使用 Chart.js 绘制饼状图，Bootstrap 5 构建UI
- **后端**：Flask + SQLAlchemy
- **数据库**：SQLite（可配置为其他数据库）

## 注意事项

1. 每个用户每天只能打卡一次
2. 打卡记录会永久保存，用于历史统计
3. 日程表显示最近30天的记录
4. 管理员可以查看任意日期的统计，但只能查看已存在的记录

