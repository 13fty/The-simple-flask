# ä»£ç æ”¹è¿›å»ºè®®æ–‡æ¡£

## ğŸ”´ ä¸¥é‡é—®é¢˜ï¼ˆå·²ä¿®å¤éƒ¨åˆ†ï¼‰

### âœ… 1. ç¼ºå°‘å¯¼å…¥ï¼ˆå·²ä¿®å¤ï¼‰
- [x] `routes/admin.py` - æ·»åŠ äº† `datetime` å¯¼å…¥
- [x] `routes/dorm.py` - æ·»åŠ äº† `datetime` å’Œ `DormApplication` å¯¼å…¥

### âœ… 2. SECRET_KEY å®‰å…¨æ€§ï¼ˆå·²æ”¹è¿›ï¼‰
- [x] æ”¹ä¸ºä»ç¯å¢ƒå˜é‡è¯»å–ï¼Œä¿ç•™é»˜è®¤å€¼ç”¨äºå¼€å‘ç¯å¢ƒ

### âœ… 3. é”™è¯¯å¤„ç†ï¼ˆå·²æ·»åŠ éƒ¨åˆ†ï¼‰
- [x] `routes/admin.py` - æ·»åŠ äº†äº‹åŠ¡å›æ»šå’Œé”™è¯¯å¤„ç†
- [x] `routes/dorm.py` - æ·»åŠ äº†äº‹åŠ¡å›æ»šå’Œä¸šåŠ¡é€»è¾‘éªŒè¯

## âš ï¸ éœ€è¦æ”¹è¿›çš„é—®é¢˜

### 1. ä»£ç æ¶æ„é—®é¢˜

#### é—®é¢˜æè¿°
`start.py` æ–‡ä»¶è¿‡å¤§ï¼ˆ1519è¡Œï¼‰ï¼ŒåŒ…å«ï¼š
- æ‰€æœ‰æ¨¡å‹å®šä¹‰ï¼ˆåº”ç§»è‡³ `models/`ï¼‰
- æ‰€æœ‰è·¯ç”±å¤„ç†ï¼ˆåº”ç§»è‡³ `routes/`ï¼‰
- ä¸šåŠ¡é€»è¾‘ï¼ˆåº”ç§»è‡³ `services/`ï¼‰

#### å»ºè®®è§£å†³æ–¹æ¡ˆ
1. å°† `start.py` é‡æ„ä¸ºåº”ç”¨å·¥å‚æ¨¡å¼
2. åˆ›å»º `app/__init__.py` ä½œä¸ºåº”ç”¨å·¥å‚
3. å°†æ‰€æœ‰è·¯ç”±ä» `start.py` ç§»é™¤ï¼Œåªä¿ç•™è“å›¾æ³¨å†Œ
4. å°†ä¸šåŠ¡é€»è¾‘ï¼ˆå¦‚ `auto_assign_dorm`ï¼‰ç§»è‡³ `services/` ç›®å½•

### 2. è·¯ç”±é‡å¤å®šä¹‰

#### é—®é¢˜æè¿°
- `start.py` ä¸­å®šä¹‰äº†å¤§é‡è·¯ç”±ï¼ˆç¬¬391-1513è¡Œï¼‰
- `routes/` ç›®å½•ä¸­ä¹Ÿæœ‰å¯¹åº”çš„è·¯ç”±å®šä¹‰
- å¯¼è‡´è·¯ç”±å†²çªæˆ–é‡å¤

#### å»ºè®®è§£å†³æ–¹æ¡ˆ
- åˆ é™¤ `start.py` ä¸­çš„æ‰€æœ‰è·¯ç”±å®šä¹‰ï¼Œåªä½¿ç”¨è“å›¾ä¸­çš„è·¯ç”±
- ç¡®ä¿æ‰€æœ‰è·¯ç”±éƒ½é€šè¿‡è“å›¾æ³¨å†Œ

### 3. æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–

#### é—®é¢˜æè¿°
- `auto_assign_dorm` å‡½æ•°ä¸­å­˜åœ¨ N+1 æŸ¥è¯¢é—®é¢˜
- ç¼ºå°‘æ•°æ®åº“ç´¢å¼•
- æœªä½¿ç”¨æŸ¥è¯¢ä¼˜åŒ–ï¼ˆå¦‚ `joinedload`ï¼‰

#### ç¤ºä¾‹é—®é¢˜ä»£ç 
```python
# start.py ç¬¬312-316è¡Œ
for other_bed in dorm.beds:
    if other_bed.status == BedStatus.OCCUPIED.value:
        other_student = Student.query.filter_by(current_bed_id=other_bed.id).first()  # N+1æŸ¥è¯¢
```

#### å»ºè®®è§£å†³æ–¹æ¡ˆ
```python
# ä½¿ç”¨ joinedload ä¼˜åŒ–
from sqlalchemy.orm import joinedload
students = Student.query.options(
    joinedload(Student.current_bed),
    joinedload(Student.major)
).filter(...).all()
```

### 4. è¾“å…¥éªŒè¯å’Œå®‰å…¨

#### é—®é¢˜æè¿°
- ç¼ºå°‘è¡¨å•éªŒè¯
- ç¼ºå°‘CSRFä¿æŠ¤
- ç¼ºå°‘è¾“å…¥æ¸…ç†

#### å»ºè®®è§£å†³æ–¹æ¡ˆ
- ä½¿ç”¨ Flask-WTF è¿›è¡Œè¡¨å•éªŒè¯
- å¯ç”¨ Flask-WTF çš„ CSRF ä¿æŠ¤
- æ·»åŠ è¾“å…¥éªŒè¯è£…é¥°å™¨

### 5. é…ç½®ç®¡ç†

#### é—®é¢˜æè¿°
- `config/settings.py` å®šä¹‰äº†é…ç½®ç±»ï¼Œä½† `start.py` æœªä½¿ç”¨
- é…ç½®ç¡¬ç¼–ç åœ¨ä»£ç ä¸­

#### å»ºè®®è§£å†³æ–¹æ¡ˆ
```python
# start.py åº”æ”¹ä¸ºï¼š
from config.settings import config
app.config.from_object(config['development'])  # æˆ–æ ¹æ®ç¯å¢ƒé€‰æ‹©
```

### 6. ä»£ç ç»„ç»‡å»ºè®®

#### å»ºè®®çš„ç›®å½•ç»“æ„
```
My_bysj/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ __init__.py          # åº”ç”¨å·¥å‚
â”‚   â”œâ”€â”€ models/              # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ routes/              # è·¯ç”±è“å›¾
â”‚   â”œâ”€â”€ services/            # ä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ utils/               # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ templates/           # æ¨¡æ¿æ–‡ä»¶
â”œâ”€â”€ config/
â”‚   â””â”€â”€ settings.py          # é…ç½®æ–‡ä»¶
â”œâ”€â”€ requirements.txt
â””â”€â”€ run.py                   # å¯åŠ¨è„šæœ¬
```

### 7. ç¼ºå°‘çš„åŠŸèƒ½

#### 7.1 æ—¥å¿—è®°å½•
- æ·»åŠ æ—¥å¿—é…ç½®
- è®°å½•å…³é”®æ“ä½œå’Œé”™è¯¯

#### 7.2 å•å…ƒæµ‹è¯•
- åˆ›å»ºæµ‹è¯•ç›®å½• `tests/`
- æ·»åŠ æ¨¡å‹æµ‹è¯•ã€è·¯ç”±æµ‹è¯•

#### 7.3 API æ–‡æ¡£
- å¦‚æœæä¾› APIï¼Œæ·»åŠ  Swagger/OpenAPI æ–‡æ¡£

#### 7.4 ç¯å¢ƒå˜é‡ç®¡ç†
- åˆ›å»º `.env.example` æ–‡ä»¶
- ä½¿ç”¨ `python-dotenv` åŠ è½½ç¯å¢ƒå˜é‡

## ğŸ“‹ å…·ä½“æ”¹è¿›æ¸…å•

### é«˜ä¼˜å…ˆçº§
- [ ] é‡æ„ `start.py` ä¸ºåº”ç”¨å·¥å‚
- [ ] åˆ é™¤é‡å¤çš„è·¯ç”±å®šä¹‰
- [ ] æ·»åŠ æ•°æ®åº“ç´¢å¼•
- [ ] ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢ï¼ˆè§£å†³ N+1 é—®é¢˜ï¼‰
- [ ] æ·»åŠ è¾“å…¥éªŒè¯å’Œ CSRF ä¿æŠ¤

### ä¸­ä¼˜å…ˆçº§
- [ ] ä½¿ç”¨é…ç½®æ–‡ä»¶æ›¿ä»£ç¡¬ç¼–ç 
- [ ] æ·»åŠ æ—¥å¿—è®°å½•
- [ ] æ·»åŠ å•å…ƒæµ‹è¯•
- [ ] åˆ›å»ºæœåŠ¡å±‚åˆ†ç¦»ä¸šåŠ¡é€»è¾‘

### ä½ä¼˜å…ˆçº§
- [ ] æ·»åŠ  API æ–‡æ¡£
- [ ] ä¼˜åŒ–ä»£ç æ³¨é‡Š
- [ ] æ·»åŠ ç±»å‹æç¤ºï¼ˆPython 3.6+ï¼‰

## ğŸ”§ å¿«é€Ÿä¿®å¤å»ºè®®

### 1. æ·»åŠ æ•°æ®åº“ç´¢å¼•
```python
# models/user.py
class Student(db.Model):
    student_id = db.Column(db.String(10), unique=True, nullable=False, index=True)
    user_id = db.Column(db.Integer, db.ForeignKey('users.id'), index=True)
    current_bed_id = db.Column(db.Integer, db.ForeignKey('beds.id'), index=True)
```

### 2. æ·»åŠ  Flask-WTF ä¿æŠ¤
```python
# requirements.txt æ·»åŠ 
Flask-WTF==1.2.1

# start.py
from flask_wtf.csrf import CSRFProtect
csrf = CSRFProtect(app)
```

### 3. åˆ›å»º .env.example
```
SECRET_KEY=your-secret-key-here
DATABASE_URL=sqlite:///dorm_system.db
FLASK_ENV=development
```

## ğŸ“ æ€»ç»“

ä¸»è¦é—®é¢˜é›†ä¸­åœ¨ï¼š
1. **ä»£ç ç»„ç»‡**ï¼šéœ€è¦é‡æ„å¤§å‹æ–‡ä»¶
2. **å®‰å…¨æ€§**ï¼šéœ€è¦æ·»åŠ éªŒè¯å’Œä¿æŠ¤
3. **æ€§èƒ½**ï¼šéœ€è¦ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢
4. **ç»´æŠ¤æ€§**ï¼šéœ€è¦æ·»åŠ æµ‹è¯•å’Œæ—¥å¿—

å»ºè®®æŒ‰ä¼˜å…ˆçº§é€æ­¥æ”¹è¿›ï¼Œå…ˆä»å®‰å…¨æ€§ç›¸å…³é—®é¢˜å¼€å§‹ã€‚
