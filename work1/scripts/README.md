# 工具脚本说明

本目录包含项目使用的各种工具脚本。

## add_dormitories.py

添加宿舍数据脚本。用于批量创建宿舍楼、宿舍和床位数据。

### 使用方法

```bash
cd /Users/MyCode/My_bysj
python scripts/add_dormitories.py
```

### 功能

- 创建10栋宿舍楼（1-10号）
- 奇数号楼为男生楼，偶数号楼为女生楼
- 每栋楼10层（1-10楼）
- 每层10个房间（5个4人间 + 5个6人间）
- 每栋楼100个宿舍，总计1000间宿舍，5000个床位

### 注意事项

- 如果数据库中已有楼栋数据，脚本会询问是否删除后重建
- 输入 'yes' 会删除所有现有数据并重建
- 直接回车会保留现有数据，只创建新楼栋

## migrate_add_fields.py

数据库迁移脚本。用于为数据库表添加新字段。

### 使用方法

```bash
cd /Users/MyCode/My_bysj
python scripts/migrate_add_fields.py
```

### 功能

- 为 students 表添加 quietness 字段（安静程度）
- 为 students 表添加 cleanliness 字段（整洁程度）

### 注意事项

- 此脚本会检查字段是否已存在，避免重复添加
- 如果字段已存在，会跳过而不报错

## migrate_attendance.py

打卡功能数据库迁移脚本。用于创建打卡记录表和更新数据库结构。

### 使用方法

```bash
cd /Users/MyCode/My_bysj
python scripts/migrate_attendance.py
```

### 功能

- 创建 attendance_records 表（如果不存在）
- 添加 check_in_time 字段（如果不存在）
- 添加唯一约束（user_id + date），确保每个用户每天只有一条记录

### 注意事项

- 如果表已存在，脚本会检查并更新结构
- 如果唯一约束已存在，会跳过而不报错

## test_system.py

系统功能测试脚本。用于测试账号注册、打卡功能、宿舍分配逻辑等核心功能。

### 使用方法

```bash
cd /Users/MyCode/My_bysj
python scripts/test_system.py
```

### 测试内容

#### 1. 用户注册功能测试
- ✅ 正常注册：测试用户和学生信息正常保存
- ✅ 重复用户名：测试用户名唯一性约束
- ✅ 重复学号：测试学号唯一性约束

#### 2. 打卡功能测试
- ✅ 首次打卡：测试创建打卡记录
- ✅ 重复打卡：测试同一天不能重复打卡
- ✅ 不同日期打卡：测试可以不同日期打卡
- ✅ 查询打卡记录：测试查询功能

#### 3. 宿舍分配逻辑测试
- ✅ 性别匹配：确保分配到正确性别的宿舍楼
- ✅ 宿舍人数偏好：测试4人间偏好分配逻辑
- ✅ 专业匹配：测试相同专业学生优先分配到同一宿舍
- ✅ 生活习惯匹配：测试生活习惯相似度匹配
- ✅ 无可用床位：测试无床位时的处理
- ✅ 性别不匹配：测试性别不匹配时的处理

### 测试结果

脚本运行后会显示：
- 每个测试用例的执行结果（✅ 通过 / ❌ 失败）
- 测试总结（总测试数、通过数、失败数、通过率）
- 失败详情（如果有失败的测试）

### 注意事项

- 测试脚本会自动清理测试数据（用户名以 `test_` 开头的用户）
- 测试过程中会创建临时测试数据，测试完成后会自动清理
- 如果测试失败，请检查数据库连接和表结构是否正确
- 建议在测试环境中运行，避免影响生产数据

